stages:
  extract:
    wdir: ../../..
    cmd: PYTHONPATH=scripts/ python scripts/metrics/schools/extract.py
    always_changed: true
    deps:
      - scripts/metrics/schools/extract.py
    outs:
      - working/metrics/airtable/schools_events.csv:
          persist: true
          cache: false

  transform:
    wdir: ../../..
    cmd: PYTHONPATH=scripts/ python scripts/metrics/schools/transform.py
    always_changed: true
    deps:
      - scripts/metrics/schools/transform.py
      - working/metrics/airtable/schools_events.csv
    outs:
      - data/metrics/schools/schools_events.csv:
          persist: true
          cache: false

  prepare:
    wdir: ../../..
    cmd: PYTHONPATH=scripts/ python scripts/metrics/schools/prepare.py
    deps:
      - scripts/metrics/schools/prepare.py
      - data/metrics/schools/schools_events.csv
    outs:
      - docs/metrics/schools/_data/summary.json:
          cache: false
      - docs/metrics/schools/_data/engagements_by_week.csv:
          cache: false
      - docs/metrics/schools/_data/school_engagement_counts.csv:
          cache: false
